<% @products.each do |product| %>
	<% dates =  product.impressions.order("created_at asc").map{|c| c.created_at.strftime("%Y-%m-%d")} %>

<% count = [] %>
<% date_x = [] %>
	<% dates.to_a.uniq.each do |c| %>
	<% count << product.impressionist_count(:start_date=> c, :end_date => c.to_date + 1.day ) %>
	<% date_x << c.to_date.strftime("%m/%d/%Y") %>
		<% end %> <br /><br />

<%= date_x %> / <%= count %>
  <% product.impressionist_count %>

<div id="container" style="width:100%; height:400px;"></div>

<script>
$(function () {
        $('#container').highcharts({
            title: {
                text: 'Monthly Visitors Count ',
                x: -20 //center
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                categories: <%= raw date_x %>
            },
            yAxis: {
                title: {
                    text: 'Count'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ' visitors'
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: "<%= product.name %>" ,
                data: <%= count %>
            }]

        });
    });

</script>
<% end %>
<%= will_paginate @products %>

